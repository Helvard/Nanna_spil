<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>üêæ Paw Patrol Vendespil - iPad Optimeret</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background-image: url('../../paw_patrol/Adventure_Bay.webp');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            overflow-x: hidden;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            max-width: 1000px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 2.2em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Start sk√¶rm */
        .start-screen {
            text-align: center;
        }

        .settings {
            margin: 20px 0;
        }

        .setting-group {
            margin: 15px 0;
        }

        .setting-group label {
            display: block;
            font-size: 1.2em;
            margin-bottom: 8px;
            color: #555;
        }

        .setting-group input,
        .setting-group select {
            font-size: 1.1em;
            padding: 12px;
            border: 2px solid #1e88e5;
            border-radius: 10px;
            width: 200px;
            background: white;
        }

        button {
            background: linear-gradient(135deg, #1e88e5 0%, #0d47a1 100%);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.4em;
            border-radius: 15px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            min-height: 60px;
            min-width: 200px;
            touch-action: manipulation;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(30, 136, 229, 0.4);
        }

        button:active {
            transform: scale(0.98);
        }

        /* Spil sk√¶rm */
        .game-screen {
            display: none;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .player-info {
            font-size: 1.1em;
            color: #333;
            min-width: 120px;
        }

        .current-player {
            font-weight: bold;
            color: #1e88e5;
        }

        .score {
            font-weight: bold;
            color: #d32f2f;
        }

        .game-board {
            display: grid;
            gap: 12px;
            margin: 15px 0;
            justify-content: center;
            perspective: 1000px;
        }

        .card {
            width: 140px;
            height: 140px;
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            border-radius: 12px;
            touch-action: manipulation;
        }

        .card:active {
            transform: scale(0.95);
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card.matched {
            animation: matchCelebration 0.8s ease-out forwards;
            pointer-events: none;
        }

        @keyframes matchCelebration {
            0% { transform: rotateY(180deg) scale(1); opacity: 1; }
            50% { transform: rotateY(180deg) scale(1.15); opacity: 1; }
            100% { transform: rotateY(180deg) scale(0.8); opacity: 0.3; }
        }

        .card-front,
        .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3em;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 0, 0, 0.1);
        }

        .card-front {
            background: linear-gradient(135deg, #1e88e5 0%, #0d47a1 100%);
            background-image: url('../../paw_patrol/images.png');
            background-size: 60%;
            background-position: center;
            background-repeat: no-repeat;
        }

        .card-back {
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
            transform: rotateY(180deg);
            padding: 10px;
        }

        .card-back img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 8px;
        }

        .card.shake {
            animation: wrongCard 0.5s ease-out;
        }

        @keyframes wrongCard {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-12px) rotate(-3deg); }
            75% { transform: translateX(12px) rotate(3deg); }
        }

        /* Progress bar */
        .progress-container {
            margin: 15px 0;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 6px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-text {
            font-size: 1.2em;
            color: #555;
            font-weight: bold;
        }

        .celebration {
            text-align: center;
            margin: 15px 0;
            font-size: 2em;
            color: #1e88e5;
            font-weight: bold;
            min-height: 40px;
            animation: celebrationBounce 0.5s ease-out;
        }

        @keyframes celebrationBounce {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Omr√•der hvor fundne par samles */
        .player-areas {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            gap: 15px;
        }

        .player-area {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 15px;
            min-height: 160px;
            flex: 1;
        }

        .player-area h3 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .collected-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            justify-items: center;
        }

        .collected-card {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #1e88e5;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            animation: collectedCardPop 0.5s ease-out;
        }

        @keyframes collectedCardPop {
            0% { transform: scale(0) rotate(180deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(90deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .collected-card img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 6px;
        }

        /* iPad specific optimizations */
        @media (max-width: 1024px) {
            .container {
                padding: 15px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .card {
                width: 120px;
                height: 120px;
            }
            
            .game-board {
                gap: 10px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8em;
                margin-bottom: 15px;
            }
            
            .card {
                width: 100px;
                height: 100px;
            }
            
            .game-info {
                flex-direction: column;
                text-align: center;
                gap: 5px;
            }
            
            .player-areas {
                flex-direction: column;
                gap: 10px;
            }
            
            button {
                padding: 15px 30px;
                font-size: 1.2em;
                min-height: 50px;
            }
        }

        @media (max-width: 480px) {
            .card {
                width: 80px;
                height: 80px;
            }
            
            .card-front,
            .card-back {
                font-size: 2em;
            }
            
            .collected-card {
                width: 60px;
                height: 60px;
            }
            
            .game-board {
                gap: 8px;
            }
        }

        /* Touch feedback */
        .card:active {
            background: rgba(30, 136, 229, 0.1);
        }

        /* Prevent zoom on double tap */
        * {
            touch-action: manipulation;
        }

        /* Loading indicator */
        .loading {
            display: none;
            text-align: center;
            font-size: 1.2em;
            color: #1e88e5;
            margin: 20px 0;
        }

        .loading.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Start sk√¶rm -->
        <div class="start-screen" id="startScreen">
            <h1>üêæ Paw Patrol Vendespil üêæ</h1>
            
            <div class="settings">
                <div class="setting-group">
                    <label for="numPairs">Antal par (5-15):</label>
                    <input type="number" id="numPairs" min="5" max="15" value="8">
                </div>
                <div class="setting-group">
                    <label for="gameMode">Spillere:</label>
                    <select id="gameMode">
                        <option value="solo">Solo</option>
                        <option value="two">To spillere</option>
                    </select>
                </div>
            </div>
            
            <button onclick="startGame()">Start Spil!</button>
        </div>

        <!-- Spil sk√¶rm -->
        <div class="game-screen" id="gameScreen">
            <h1>üêæ Paw Patrol Vendespil üêæ</h1>
            
            <div class="progress-container">
                <div class="progress-text" id="progressText">0 par fundet</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            
            <div class="game-info" id="gameInfo"></div>
            <div class="celebration" id="celebration"></div>
            <div class="loading" id="loading">Indl√¶ser...</div>
            <div class="game-board" id="gameBoard"></div>
            <div class="player-areas" id="playerAreas"></div>
            <div style="text-align: center;">
                <button onclick="restartGame()">Nyt Spil</button>
            </div>
        </div>
    </div>

    <script>
        // PAW PATROL BILLEDER
        const CARD_IMAGES = [
            '../../paw_patrol/download.jpeg',
            '../../paw_patrol/download (1).jpeg',
            '../../paw_patrol/download (2).jpeg',
            '../../paw_patrol/download (3).jpeg',
            '../../paw_patrol/download (4).jpeg',
            '../../paw_patrol/download (5).jpeg',
            '../../paw_patrol/images.jpeg',
            '../../paw_patrol/images (1).jpeg',
            '../../paw_patrol/images (2).jpeg',
            '../../paw_patrol/images (3).jpeg',
            '../../paw_patrol/images (4).jpeg',
            '../../paw_patrol/images (5).jpeg',
            '../../paw_patrol/images (6).jpeg',
            '../../paw_patrol/images (7).jpeg',
            '../../paw_patrol/images (8).jpeg',
            '../../paw_patrol/zuma-labrador-retriever-puppy-clip-art-paw-patrol.jpg'
        ];

        // SPIL LOGIK
        let numPairs = 8;
        let gameMode = 'solo';
        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let currentPlayer = 1;
        let scores = { player1: 0, player2: 0 };
        let canFlip = true;
        let totalMoves = 0;
        let gameStartTime = 0;

        // Touch optimization
        let touchTimeout;

        function startGame() {
            console.log('Starting game on iPad...');
            
            numPairs = parseInt(document.getElementById('numPairs').value);
            gameMode = document.getElementById('gameMode').value;
            
            if (numPairs < 5 || numPairs > 15) {
                alert('V√¶lg venligst mellem 5 og 15 par!');
                return;
            }

            // Reset spillet
            matchedPairs = 0;
            currentPlayer = 1;
            scores = { player1: 0, player2: 0 };
            flippedCards = [];
            canFlip = true;
            totalMoves = 0;
            gameStartTime = Date.now();

            // Show loading
            document.getElementById('loading').classList.add('show');

            // Opret kort
            createCards();

            // Opret spilleromr√•der
            createPlayerAreas();

            // Skjul start sk√¶rm, vis spil sk√¶rm
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';

            // Hide loading after cards are created
            setTimeout(() => {
                document.getElementById('loading').classList.remove('show');
            }, 500);

            updateGameInfo();
            updateProgress();
        }

        function createCards() {
            console.log('Creating cards for iPad...');
            
            const gameBoard = document.getElementById('gameBoard');
            gameBoard.innerHTML = '';

            // V√¶lg billeder baseret p√• antal par
            const selectedImages = CARD_IMAGES.slice(0, numPairs);
            
            // Lav par og bland
            cards = [...selectedImages, ...selectedImages]
                .sort(() => Math.random() - 0.5)
                .map((image, index) => ({
                    id: index,
                    image: image,
                    matched: false
                }));

            console.log('Cards created:', cards.length);

            // Beregn grid st√∏rrelse baseret p√• sk√¶rmst√∏rrelse
            const screenWidth = window.innerWidth;
            let cardSize, cols, gap;
            
            if (screenWidth > 1024) {
                cardSize = 140; cols = Math.min(6, Math.ceil(Math.sqrt(cards.length)));
            } else if (screenWidth > 768) {
                cardSize = 120; cols = Math.min(5, Math.ceil(Math.sqrt(cards.length)));
            } else if (screenWidth > 480) {
                cardSize = 100; cols = Math.min(4, Math.ceil(Math.sqrt(cards.length)));
            } else {
                cardSize = 80; cols = Math.min(3, Math.ceil(Math.sqrt(cards.length)));
            }
            
            gap = screenWidth > 768 ? 12 : 8;
            
            gameBoard.style.gridTemplateColumns = `repeat(${cols}, ${cardSize}px)`;
            gameBoard.style.gap = `${gap}px`;

            // Opret kort elementer
            cards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.dataset.index = index;
                
                // Touch event handlers for iPad
                cardElement.addEventListener('touchstart', handleTouchStart, { passive: false });
                cardElement.addEventListener('touchend', handleTouchEnd, { passive: false });
                cardElement.addEventListener('click', () => flipCard(index));

                // Check om billedet er en fil-sti eller emoji
                const isImageFile = card.image.includes('.') || card.image.includes('/');
                
                cardElement.innerHTML = `
                    <div class="card-front"></div>
                    <div class="card-back">
                        ${isImageFile ? `<img src="${card.image}" alt="Paw Patrol">` : card.image}
                    </div>
                `;

                gameBoard.appendChild(cardElement);
            });
        }

        function handleTouchStart(e) {
            e.preventDefault();
            const card = e.currentTarget;
            card.style.transform = 'scale(0.95)';
            
            // Clear any existing timeout
            if (touchTimeout) {
                clearTimeout(touchTimeout);
            }
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            const card = e.currentTarget;
            card.style.transform = '';
            
            // Prevent multiple rapid taps
            touchTimeout = setTimeout(() => {
                const index = parseInt(card.dataset.index);
                flipCard(index);
            }, 100);
        }

        function createPlayerAreas() {
            const playerAreas = document.getElementById('playerAreas');
            playerAreas.innerHTML = '';

            if (gameMode === 'solo') {
                playerAreas.innerHTML = `
                    <div class="player-area">
                        <h3>üèÜ Fundne Par</h3>
                        <div class="collected-cards" id="collected-solo"></div>
                    </div>
                `;
            } else {
                playerAreas.innerHTML = `
                    <div class="player-area">
                        <h3>üéÆ Spiller 1</h3>
                        <div class="collected-cards" id="collected-player1"></div>
                    </div>
                    <div class="player-area">
                        <h3>üéÆ Spiller 2</h3>
                        <div class="collected-cards" id="collected-player2"></div>
                    </div>
                `;
            }
        }

        function addCardToPlayerArea(image, player) {
            const targetId = gameMode === 'solo' ? 'collected-solo' : `collected-player${player}`;
            const collectedArea = document.getElementById(targetId);
            
            const isImageFile = image.includes('.') || image.includes('/');
            
            const cardDiv = document.createElement('div');
            cardDiv.className = 'collected-card';
            cardDiv.innerHTML = isImageFile ? `<img src="${image}" alt="Paw Patrol">` : image;
            
            collectedArea.appendChild(cardDiv);
        }

        function flipCard(index) {
            console.log('Card touched:', index);
            
            if (!canFlip) {
                console.log('Cannot flip - canFlip is false');
                return;
            }
            if (cards[index].matched) {
                console.log('Cannot flip - card already matched');
                return;
            }
            if (flippedCards.some(card => card.index === index)) {
                console.log('Cannot flip - card already flipped');
                return;
            }
            if (flippedCards.length >= 2) {
                console.log('Cannot flip - too many cards flipped');
                return;
            }

            const cardElement = document.querySelector(`[data-index="${index}"]`);
            
            if (cardElement) {
                cardElement.classList.add('flipped');
                flippedCards.push({ index, image: cards[index].image });

                if (flippedCards.length === 2) {
                    totalMoves++;
                    checkMatch();
                }
            }
        }

        function checkMatch() {
            console.log('Checking match...');
            canFlip = false;
            const [card1, card2] = flippedCards;

            if (card1.image === card2.image) {
                // Match!
                console.log('Match found!');
                setTimeout(() => {
                    cards[card1.index].matched = true;
                    cards[card2.index].matched = true;
                    
                    const cardElement1 = document.querySelector(`[data-index="${card1.index}"]`);
                    const cardElement2 = document.querySelector(`[data-index="${card2.index}"]`);
                    
                    if (cardElement1) cardElement1.classList.add('matched');
                    if (cardElement2) cardElement2.classList.add('matched');
                    
                    matchedPairs++;
                    updateProgress();

                    // Tilf√∏j kort til spillerens omr√•de
                    if (gameMode === 'two') {
                        scores[`player${currentPlayer}`]++;
                        addCardToPlayerArea(card1.image, currentPlayer);
                    } else {
                        addCardToPlayerArea(card1.image, 1);
                    }

                    showCelebration('üéâ Godt klaret! üéâ');
                    flippedCards = [];
                    canFlip = true;

                    if (matchedPairs === numPairs) {
                        setTimeout(endGame, 500);
                    } else {
                        updateGameInfo();
                    }
                }, 500);
            } else {
                // Ikke match
                console.log('No match');
                setTimeout(() => {
                    const cardElement1 = document.querySelector(`[data-index="${card1.index}"]`);
                    const cardElement2 = document.querySelector(`[data-index="${card2.index}"]`);
                    
                    if (cardElement1) {
                        cardElement1.classList.remove('flipped');
                        cardElement1.classList.add('shake');
                        setTimeout(() => cardElement1.classList.remove('shake'), 500);
                    }
                    if (cardElement2) {
                        cardElement2.classList.remove('flipped');
                        cardElement2.classList.add('shake');
                        setTimeout(() => cardElement2.classList.remove('shake'), 500);
                    }
                    
                    flippedCards = [];

                    if (gameMode === 'two') {
                        currentPlayer = currentPlayer === 1 ? 2 : 1;
                    }

                    canFlip = true;
                    updateGameInfo();
                }, 1000);
            }
        }

        function updateGameInfo() {
            const gameInfo = document.getElementById('gameInfo');
            
            if (gameMode === 'solo') {
                const gameTime = Math.floor((Date.now() - gameStartTime) / 1000);
                const minutes = Math.floor(gameTime / 60);
                const seconds = gameTime % 60;
                
                gameInfo.innerHTML = `
                    <div class="player-info">Par: <span class="score">${matchedPairs}/${numPairs}</span></div>
                    <div class="player-info">Tid: <span class="score">${minutes}:${seconds.toString().padStart(2, '0')}</span></div>
                    <div class="player-info">Flyt: <span class="score">${totalMoves}</span></div>
                `;
            } else {
                gameInfo.innerHTML = `
                    <div class="player-info">Spiller 1: <span class="score">${scores.player1}</span></div>
                    <div class="player-info current-player">Spiller ${currentPlayer}</div>
                    <div class="player-info">Spiller 2: <span class="score">${scores.player2}</span></div>
                `;
            }
        }

        function updateProgress() {
            const progress = (matchedPairs / numPairs) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${matchedPairs} af ${numPairs} par fundet`;
        }

        function showCelebration(message) {
            const celebration = document.getElementById('celebration');
            celebration.textContent = message;
            setTimeout(() => {
                celebration.textContent = '';
            }, 2000);
        }

        function endGame() {
            const celebration = document.getElementById('celebration');
            
            if (gameMode === 'solo') {
                const gameTime = Math.floor((Date.now() - gameStartTime) / 1000);
                const minutes = Math.floor(gameTime / 60);
                const seconds = gameTime % 60;
                const efficiency = Math.round((numPairs / totalMoves) * 100);
                
                celebration.innerHTML = `
                    üåü Fantastisk! üåü<br>
                    <small>Tid: ${minutes}:${seconds.toString().padStart(2, '0')} | Flyt: ${totalMoves} | Effektivitet: ${efficiency}%</small>
                `;
            } else {
                if (scores.player1 > scores.player2) {
                    celebration.textContent = 'üèÜ Spiller 1 Vinder! üèÜ';
                } else if (scores.player2 > scores.player1) {
                    celebration.textContent = 'üèÜ Spiller 2 Vinder! üèÜ';
                } else {
                    celebration.textContent = 'ü§ù Uafgjort! ü§ù';
                }
            }
        }

        function restartGame() {
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'block';
            document.getElementById('celebration').textContent = '';
        }

        // Handle window resize for responsive layout
        window.addEventListener('resize', () => {
            if (document.getElementById('gameScreen').style.display === 'block') {
                createCards();
            }
        });

        // Prevent default touch behaviors
        document.addEventListener('touchstart', (e) => {
            if (e.touches.length > 1) {
                e.preventDefault(); // Prevent zoom on multi-touch
            }
        }, { passive: false });

        console.log('iPad optimized vendespil loaded successfully!');
    </script>
</body>
</html>
