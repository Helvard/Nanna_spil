<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mini 10.000</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --gold:      #f1c40f;
      --gold-dark: #c9a600;
      --green:     #27ae60;
      --red:       #e74c3c;
      --bg:        #1a1a2e;
      --die-size:  clamp(68px, 14vw, 92px);
    }

    html, body { width: 100%; height: 100%; overflow: hidden; }

    body {
      background: var(--bg);
      background-image:
        radial-gradient(ellipse at 20% 15%, rgba(60,30,80,0.4) 0%, transparent 55%),
        radial-gradient(ellipse at 80% 85%, rgba(20,60,40,0.35) 0%, transparent 55%);
      font-family: 'Georgia', serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      color: #fff;
    }

    .corner-deco {
      position: fixed;
      font-size: clamp(2rem, 5vw, 3.5rem);
      opacity: 0.1;
      pointer-events: none;
      user-select: none;
    }
    .corner-deco.tl { top: 0.6rem;    left: 0.8rem;  }
    .corner-deco.tr { top: 0.6rem;    right: 0.8rem; }
    .corner-deco.bl { bottom: 0.6rem; left: 0.8rem;  }
    .corner-deco.br { bottom: 0.6rem; right: 0.8rem; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LAYOUT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #game-screen {
      width: 100%;
      max-width: 620px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.8rem 1rem 1rem;
      gap: 0.6rem;
    }

    h1 {
      font-size: clamp(1.3rem, 4vw, 1.9rem);
      color: var(--gold);
      letter-spacing: 3px;
      text-shadow: 0 0 16px rgba(241,196,15,0.4);
      flex-shrink: 0;
    }

    /* â”€â”€ Scoreboard â”€â”€ */
    #scoreboard {
      display: flex;
      gap: 0.8rem;
      width: 100%;
      flex-shrink: 0;
    }

    .score-card {
      flex: 1;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 14px;
      padding: 0.6rem 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.1rem;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    .score-card.active-turn {
      border-color: var(--gold);
      box-shadow: 0 0 14px rgba(241,196,15,0.2);
    }
    .score-card .player-name {
      font-size: 0.72rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      font-family: sans-serif;
      opacity: 0.6;
    }
    .score-card .total-score {
      font-size: clamp(1.6rem, 4.5vw, 2.2rem);
      font-weight: bold;
      color: var(--gold);
      line-height: 1;
    }
    .goal-bar-wrap {
      width: 100%;
      height: 4px;
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 0.2rem;
    }
    .goal-bar {
      height: 100%;
      background: var(--gold);
      border-radius: 3px;
      transition: width 0.5s ease;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FILT-BORD
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #table {
      flex: 1;
      width: 100%;
      position: relative;
      border-radius: 28px;
      background: radial-gradient(ellipse at 50% 50%, #2d6a4f 0%, #1b4332 100%);
      border: 5px solid #3d2b1f;
      box-shadow:
        0 0 0 2px rgba(255,255,255,0.05),
        0 0 0 9px #2a1f15,
        0 0 0 11px rgba(255,255,255,0.03),
        0 16px 50px rgba(0,0,0,0.8),
        inset 0 0 60px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.2rem 1rem;
      gap: 0.5rem;
      overflow: hidden;
    }

    #table::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 24px;
      background-image: repeating-linear-gradient(
        45deg, transparent, transparent 2px,
        rgba(0,0,0,0.025) 2px, rgba(0,0,0,0.025) 4px
      );
      pointer-events: none;
    }

    /* â”€â”€ Tur-point â”€â”€ */
    #turn-score-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
      z-index: 1;
      flex-shrink: 0;
    }
    #turn-label {
      font-size: 0.68rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      font-family: sans-serif;
      opacity: 0.5;
    }
    #turn-score {
      font-size: clamp(1.8rem, 5.5vw, 2.8rem);
      font-weight: bold;
      color: var(--green);
      line-height: 1;
      text-shadow: 0 0 12px rgba(39,174,96,0.4);
      transition: color 0.2s;
    }
    #turn-score.bust { color: var(--red); }

    /* â”€â”€ Status â”€â”€ */
    #status-msg {
      font-size: clamp(0.85rem, 2.2vw, 1rem);
      font-family: sans-serif;
      font-weight: bold;
      text-align: center;
      color: rgba(255,255,255,0.85);
      min-height: 1.3rem;
      z-index: 1;
      flex-shrink: 0;
    }
    #status-msg.bust-msg { color: var(--red); }
    #status-msg.comp-msg { color: rgba(255,255,255,0.55); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HOLDTE TERNINGER (Ã¸verst)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #held-area-wrap {
      width: 100%;
      z-index: 1;
      flex-shrink: 0;
    }
    #held-label {
      font-size: 0.65rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      font-family: sans-serif;
      opacity: 0.45;
      text-align: center;
      margin-bottom: 0.3rem;
    }
    #held-area {
      display: flex;
      gap: clamp(0.4rem, 1.5vw, 0.7rem);
      align-items: center;
      justify-content: center;
      min-height: calc(var(--die-size) * 0.75);
      background: rgba(0,0,0,0.18);
      border-radius: 14px;
      border: 1.5px dashed rgba(255,255,255,0.1);
      padding: 0.4rem 0.6rem;
    }
    #held-area:empty::after {
      content: 'Ingen holdte terninger';
      font-family: sans-serif;
      font-size: 0.75rem;
      color: rgba(255,255,255,0.2);
      letter-spacing: 1px;
    }

    /* Holdte terninger er mindre */
    #held-area .die {
      width: calc(var(--die-size) * 0.78);
      height: calc(var(--die-size) * 0.78);
    }

    /* Skillelinje */
    .table-divider {
      width: 90%;
      height: 1px;
      background: rgba(255,255,255,0.07);
      flex-shrink: 0;
      z-index: 1;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AKTIVE TERNINGER (kastes)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #dice-area {
      display: flex;
      gap: clamp(0.4rem, 1.8vw, 0.9rem);
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      z-index: 1;
      flex-shrink: 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TERNING
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .die {
      width: var(--die-size);
      height: var(--die-size);
      border-radius: clamp(10px, 2vw, 15px);
      position: relative;
      flex-shrink: 0;
      cursor: default;

      /* 3D-perspektiv */
      transform-style: preserve-3d;
      perspective: 400px;

      /* Hvid top-flade */
      background: #f8f8f8;
      box-shadow:
        0 2px 0 #ccc,           /* bund-kant (tykkelse) */
        2px 4px 0 #bbb,         /* hÃ¸jre side */
        0 6px 18px rgba(0,0,0,0.45),
        inset 0 1px 0 rgba(255,255,255,0.9);
    }

    /* Scoring: grÃ¸n glÃ¸d */
    .die--scoring {
      cursor: pointer;
      box-shadow:
        0 2px 0 #1a7a42,
        2px 4px 0 #157a39,
        0 6px 18px rgba(39,174,96,0.5),
        0 0 0 3px var(--green);
      animation: scoringPulse 1s ease-in-out infinite alternate;
    }
    @keyframes scoringPulse {
      from { box-shadow: 0 2px 0 #1a7a42, 2px 4px 0 #157a39, 0 6px 14px rgba(39,174,96,0.4), 0 0 0 3px var(--green); }
      to   { box-shadow: 0 2px 0 #1a7a42, 2px 4px 0 #157a39, 0 6px 24px rgba(39,174,96,0.75), 0 0 0 4px var(--green); }
    }

    /* Holdt (i held-area) */
    .die--held {
      background: #fffbe6;
      box-shadow:
        0 2px 0 #a08a00,
        2px 4px 0 #8a7800,
        0 6px 16px rgba(241,196,15,0.45),
        0 0 0 3px var(--gold);
      cursor: pointer;
    }

    /* Rulle-animation â€” 3D flip */
    .die--rolling {
      animation: dieRoll3D 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    @keyframes dieRoll3D {
      0%   {
        transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg) translateY(0px);
      }
      15%  {
        transform: rotateX(-40deg) rotateY(30deg) rotateZ(-10deg) translateY(-8px);
      }
      35%  {
        transform: rotateX(180deg) rotateY(-60deg) rotateZ(20deg) translateY(-14px);
      }
      55%  {
        transform: rotateX(270deg) rotateY(45deg) rotateZ(-15deg) translateY(-8px);
      }
      75%  {
        transform: rotateX(330deg) rotateY(-20deg) rotateZ(8deg) translateY(-3px);
      }
      88%  {
        transform: rotateX(355deg) rotateY(5deg) rotateZ(-3deg) translateY(-1px);
      }
      100% {
        transform: rotateX(360deg) rotateY(0deg) rotateZ(0deg) translateY(0px);
      }
    }

    /* Terninger der ikke kastes (allerede holdt) hopper blidt */
    .die--held-bounce {
      animation: heldBounce 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    @keyframes heldBounce {
      0%,100% { transform: translateY(0); }
      40%     { transform: translateY(-4px); }
    }

    /* Bust */
    .die--bust {
      animation: dieBust 0.55s ease-in-out;
    }
    @keyframes dieBust {
      0%,100% { transform: translate(0,0) rotate(0deg); }
      15%     { transform: translate(-6px,-4px) rotate(-8deg); }
      35%     { transform: translate(8px, 3px) rotate(10deg); }
      55%     { transform: translate(-5px, 5px) rotate(-6deg); }
      75%     { transform: translate(4px,-3px) rotate(5deg); }
    }

    /* Fly-animation â€” terning flyver til held-area */
    .die--fly {
      animation: dieFly 0.35s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }
    @keyframes dieFly {
      to { transform: translateY(-60px) scale(0.78); opacity: 0; }
    }

    /* Terningeprikker */
    .die__face {
      width: 68%;
      height: 68%;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows:    repeat(3, 1fr);
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
    }

    .die__dot {
      width: clamp(7px, 1.8vw, 11px);
      height: clamp(7px, 1.8vw, 11px);
      background: #1a1a1a;
      border-radius: 50%;
      align-self: center;
      justify-self: center;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.3);
    }

    /* RÃ¸de prikker pÃ¥ 1'er og 5'er nÃ¥r scoring */
    .die--scoring .die__dot { background: #1a5c2e; }
    .die--held    .die__dot { background: #5c4a00; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       KNAPPER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #btn-area {
      display: flex;
      gap: 0.8rem;
      width: 100%;
      z-index: 1;
      flex-shrink: 0;
    }

    .game-btn {
      flex: 1;
      padding: 0.9rem;
      border: none;
      border-radius: 14px;
      font-size: clamp(1rem, 2.8vw, 1.3rem);
      font-weight: bold;
      font-family: sans-serif;
      cursor: pointer;
      letter-spacing: 1px;
      transition: transform 0.1s, opacity 0.2s;
    }
    .game-btn:active   { transform: translateY(2px); }
    .game-btn:disabled { opacity: 0.3; cursor: default; transform: none; }

    #btn-roll {
      background: linear-gradient(135deg, var(--gold) 0%, #e67e22 100%);
      color: #1a1a1a;
      box-shadow: 0 4px 0 var(--gold-dark), 0 6px 16px rgba(241,196,15,0.2);
    }
    #btn-stop {
      background: linear-gradient(135deg, var(--green) 0%, #1e8449 100%);
      color: #fff;
      box-shadow: 0 4px 0 #1a6b39, 0 6px 16px rgba(39,174,96,0.2);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BUST-OVERLAY
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #bust-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(200,0,0,0.15);
      pointer-events: none;
      z-index: 200;
    }
    #bust-overlay.show {
      display: block;
      animation: bustFlash 0.7s ease-out forwards;
    }
    @keyframes bustFlash {
      0%   { opacity: 1; }
      100% { opacity: 0; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SCORE-POPUP
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .score-popup {
      position: fixed;
      font-size: 2.4rem;
      font-weight: 900;
      color: var(--green);
      text-shadow: 0 0 16px rgba(39,174,96,0.6);
      pointer-events: none;
      z-index: 250;
      animation: scoreFloat 1.3s ease-out forwards;
      font-family: sans-serif;
    }
    @keyframes scoreFloat {
      0%   { opacity: 1; transform: translateY(0) scale(1); }
      60%  { opacity: 1; transform: translateY(-55px) scale(1.2); }
      100% { opacity: 0; transform: translateY(-100px) scale(0.9); }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       COMPUTER-INDIKATOR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #comp-thinking {
      display: none;
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.65);
      border-radius: 12px;
      padding: 0.5rem 1.2rem;
      font-family: sans-serif;
      font-size: 0.85rem;
      color: rgba(255,255,255,0.65);
      letter-spacing: 1px;
      z-index: 10;
    }
    #comp-thinking.show { display: block; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SLUT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #end-screen {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.82);
      align-items: center;
      justify-content: center;
      z-index: 400;
    }
    #end-screen.show { display: flex; }

    #end-box {
      background: linear-gradient(160deg, #1b2838 0%, #0f1923 100%);
      border: 2px solid rgba(241,196,15,0.35);
      border-radius: 28px;
      padding: 2.5rem 3rem;
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
      max-width: 360px;
      width: 90%;
      box-shadow: 0 0 60px rgba(0,0,0,0.9);
    }
    #end-box h2 { font-size: clamp(1.8rem, 6vw, 2.5rem); color: var(--gold); text-shadow: 0 0 16px rgba(241,196,15,0.4); }
    #end-box p  { font-size: 1rem; color: rgba(255,255,255,0.6); font-family: sans-serif; }
    #play-again-btn {
      padding: 1rem 2rem;
      border: none;
      border-radius: 14px;
      background: linear-gradient(135deg, var(--gold) 0%, #e67e22 100%);
      color: #1a1a1a;
      font-size: 1.2rem;
      font-weight: bold;
      font-family: sans-serif;
      cursor: pointer;
      box-shadow: 0 4px 0 var(--gold-dark);
    }

    @media (max-height: 700px) {
      :root { --die-size: 58px; }
      #game-screen { gap: 0.3rem; padding: 0.5rem; }
      h1 { font-size: 1.1rem; }
      #table { padding: 0.7rem; }
    }
  </style>
</head>
<body>

<div class="corner-deco tl">âš„</div>
<div class="corner-deco tr">âš…</div>
<div class="corner-deco bl">âš‚</div>
<div class="corner-deco br">âšƒ</div>
<div id="bust-overlay"></div>

<div id="game-screen">

  <h1>ğŸ² Mini 10.000</h1>

  <div id="scoreboard">
    <div class="score-card active-turn" id="card-nanna">
      <div class="player-name">Nanna</div>
      <div class="total-score" id="score-nanna">0</div>
      <div class="goal-bar-wrap"><div class="goal-bar" id="bar-nanna" style="width:0%"></div></div>
    </div>
    <div class="score-card" id="card-comp">
      <div class="player-name">Computer</div>
      <div class="total-score" id="score-comp">0</div>
      <div class="goal-bar-wrap"><div class="goal-bar" id="bar-comp" style="width:0%"></div></div>
    </div>
  </div>

  <div id="table">
    <div id="comp-thinking">Computer tÃ¦nker...</div>

    <!-- Tur-point -->
    <div id="turn-score-area">
      <div id="turn-label">Point denne tur</div>
      <div id="turn-score">0</div>
    </div>

    <!-- Status -->
    <div id="status-msg">Tryk Kast! for at starte</div>

    <!-- Holdte terninger -->
    <div id="held-area-wrap">
      <div id="held-label">Holdte terninger</div>
      <div id="held-area"></div>
    </div>

    <div class="table-divider"></div>

    <!-- Aktive terninger -->
    <div id="dice-area"></div>

    <!-- Knapper -->
    <div id="btn-area">
      <button class="game-btn" id="btn-roll">ğŸ² Kast!</button>
      <button class="game-btn" id="btn-stop" disabled>âœ‹ Stop!</button>
    </div>

  </div>
</div>

<div id="end-screen">
  <div id="end-box">
    <h2 id="end-title"></h2>
    <p id="end-detail"></p>
    <button id="play-again-btn">Spil igen ğŸ²</button>
  </div>
</div>

<script src="dice.js"></script>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KONSTANTER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const GOAL         = 500;
const COMP_STOP_AT = 150;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TILSTAND
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let nannaTotal  = 0;
let compTotal   = 0;
let turnScore   = 0;
let currentTurn = 'nanna';

// activeDice: terninger der er "pÃ¥ bordet" (ikke holdt endnu)
// heldDice:   terninger der er bekrÃ¦ftet holdt denne tur
let activeDice  = [];  // {id, value, held:false}
let heldDice    = [];  // {id, value, held:true}

let busy        = false;
let hasRolled   = false;
let canHold     = false; // Om Nanna mÃ¥ trykke pÃ¥ terninger

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const btnRoll      = document.getElementById('btn-roll');
const btnStop      = document.getElementById('btn-stop');
const diceArea     = document.getElementById('dice-area');
const heldArea     = document.getElementById('held-area');
const turnScoreEl  = document.getElementById('turn-score');
const statusEl     = document.getElementById('status-msg');
const compThinking = document.getElementById('comp-thinking');
const bustOverlay  = document.getElementById('bust-overlay');
const endScreen    = document.getElementById('end-screen');

btnRoll.addEventListener('click', onRoll);
btnStop.addEventListener('click', onStop);
document.getElementById('play-again-btn').addEventListener('click', restartGame);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// START
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function restartGame() {
  nannaTotal  = 0; compTotal = 0; turnScore = 0;
  currentTurn = 'nanna';
  activeDice  = []; heldDice = [];
  busy = false; hasRolled = false; canHold = false;

  endScreen.classList.remove('show');
  updateScoreboard();
  renderActiveDice([]);
  renderHeldDice([]);
  setTurnScore(0);
  setStatus('Tryk Kast! for at starte');
  setActiveTurn('nanna');
  btnRoll.disabled = false;
  btnStop.disabled = true;
}

restartGame();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KAST (Nanna)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function onRoll() {
  if (busy || currentTurn !== 'nanna') return;
  busy     = true;
  canHold  = false;
  btnRoll.disabled = true;
  btnStop.disabled = true;

  // Hot dice: hvis alle 6 er holdt, nulstil og kast alle 6 igen
  if (heldDice.length === 6) {
    heldDice = [];
    renderHeldDice([]);
    setStatus('ğŸ”¥ Alle seks! Kaster igen...');
    await wait(400);
  }

  // Kast kun de ikke-holdte terninger (6 - antal holdte)
  const numToRoll = 6 - heldDice.length;
  const newRolled = rollFresh(numToRoll, heldDice.length); // id'er starter efter holdte
  activeDice = newRolled;
  hasRolled  = true;

  // Animer
  renderActiveDice(activeDice, true);
  await wait(600);

  // Find hvilke af de nye terninger der er pointgivende
  const scoringIds = scoringDiceIdsMini(activeDice);
  const newPoints  = scoreRollMini(activeDice);

  if (newPoints === 0) {
    await doBust();
    return;
  }

  // MarkÃ©r scoring-terninger, lad Nanna vÃ¦lge hvad hun vil holde
  renderActiveDiceWithScoring(activeDice, scoringIds);
  setStatus('Tryk pÃ¥ de grÃ¸nne terninger for at holde dem â€” kast resten igen eller stop');
  canHold = true;

  // Tur-score vises ikke endnu â€” kun nÃ¥r hun har valgt og trykker
  btnRoll.disabled = false;
  btnStop.disabled = false;
  busy = false;
}

// Kast n friske terninger med id'er der starter ved startId
function rollFresh(n, startId) {
  const result = [];
  for (let i = 0; i < n; i++) {
    result.push({ id: startId + i, value: Math.floor(Math.random() * 6) + 1, held: false });
  }
  return result;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOLD TERNING (klik)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onDieClick(die, scoringIds) {
  if (!canHold || currentTurn !== 'nanna') return;
  if (!scoringIds.has(die.id)) return; // kun scoring-terninger mÃ¥ holdes

  // Flyt fra active til held
  activeDice = activeDice.filter(d => d.id !== die.id);
  heldDice.push({ ...die, held: true });

  // Opdater turn-score med alle holdte terningers vÃ¦rdi
  turnScore = scoreRollMini(heldDice);
  setTurnScore(turnScore);

  // Genrender begge omrÃ¥der
  const remainingScoring = scoringDiceIdsMini(activeDice);
  renderActiveDiceWithScoring(activeDice, remainingScoring);
  renderHeldDice(heldDice);

  if (activeDice.length === 0) {
    setStatus('Alle terninger holdt! Kast igen (alle 6) eller stop');
  } else if (activeDice.filter(d => !remainingScoring.has(d.id)).length === activeDice.length) {
    setStatus('Ingen flere pointgivende â€” kast igen eller stop');
  } else {
    setStatus('Tryk pÃ¥ flere grÃ¸nne terninger â€” eller kast/stop');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STOP (Nanna)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function onStop() {
  if (busy || currentTurn !== 'nanna' || !hasRolled) return;
  if (heldDice.length === 0 && turnScore === 0) return; // intet at banke
  busy    = true;
  canHold = false;
  btnRoll.disabled = true;
  btnStop.disabled = true;

  const banked = turnScore;
  nannaTotal += banked;
  showScorePopup(banked);
  updateScoreboard();
  setStatus(`Nanna banker ${banked} point! ğŸ‰`);

  await wait(1000);

  if (nannaTotal >= GOAL) { endGame('nanna'); return; }
  await startCompTurn();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BUST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function doBust() {
  canHold = false;
  renderActiveDiceBust(activeDice);
  bustOverlay.classList.add('show');
  setTurnScore(0, true);
  setStatus('BUST! Mister alle point for denne tur ğŸ˜¬', 'bust-msg');

  await wait(100);
  bustOverlay.classList.remove('show');
  await wait(900);

  turnScore  = 0;
  hasRolled  = false;
  activeDice = [];
  heldDice   = [];
  renderActiveDice([]);
  renderHeldDice([]);
  setTurnScore(0);

  if (currentTurn === 'nanna') {
    await wait(400);
    await startCompTurn();
  } else {
    endCompTurn();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPUTER-TUR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function startCompTurn() {
  currentTurn = 'comp';
  turnScore   = 0;
  hasRolled   = false;
  activeDice  = [];
  heldDice    = [];
  setActiveTurn('comp');
  setStatus('Computerens tur...', 'comp-msg');
  setTurnScore(0);
  renderActiveDice([]);
  renderHeldDice([]);
  await wait(700);
  await compPlayTurn();
}

async function compPlayTurn() {
  while (true) {
    compThinking.classList.add('show');
    await wait(500 + Math.random() * 400);
    compThinking.classList.remove('show');

    // Kast de resterende (ikke-holdte)
    const numToRoll = 6 - heldDice.length;
    activeDice = rollFresh(numToRoll, heldDice.length);
    hasRolled  = true;
    renderActiveDice(activeDice, true);
    await wait(650);

    const scoringIds = scoringDiceIdsMini(activeDice);
    const newPoints  = scoreRollMini(activeDice);

    if (newPoints === 0) {
      setStatus('Computer bustede! ğŸ˜¬', 'comp-msg');
      await doBust();
      return;
    }

    // Computer holder alle scoring-terninger automatisk
    const scoringDice = activeDice.filter(d => scoringIds.has(d.id));
    heldDice.push(...scoringDice.map(d => ({ ...d, held: true })));
    activeDice = activeDice.filter(d => !scoringIds.has(d.id));
    turnScore  = scoreRollMini(heldDice);

    renderActiveDiceWithScoring(activeDice, new Set());
    renderHeldDice(heldDice);
    setTurnScore(turnScore);
    setStatus(`Computer: +${newPoints} (${turnScore} i alt)`, 'comp-msg');
    await wait(900);

    const wouldTotal = compTotal + turnScore;
    if (turnScore >= COMP_STOP_AT || wouldTotal >= GOAL) {
      compTotal += turnScore;
      setStatus(`Computer stopper med ${turnScore} point`, 'comp-msg');
      updateScoreboard();
      await wait(800);
      if (compTotal >= GOAL) { endGame('comp'); return; }
      endCompTurn();
      return;
    }

    await wait(300);
  }
}

function endCompTurn() {
  currentTurn = 'nanna';
  turnScore   = 0;
  hasRolled   = false;
  activeDice  = [];
  heldDice    = [];
  canHold     = false;
  renderActiveDice([]);
  renderHeldDice([]);
  setTurnScore(0);
  setActiveTurn('nanna');
  setStatus('Din tur! Tryk Kast!');
  btnRoll.disabled = false;
  btnStop.disabled = true;
  busy = false;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SLUT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function checkEnd() {
  if (nannaTotal >= GOAL) { endGame('nanna'); return true; }
  if (compTotal  >= GOAL) { endGame('comp');  return true; }
  return false;
}

function endGame(winner) {
  busy = true;
  btnRoll.disabled = true;
  btnStop.disabled = true;
  const title  = winner === 'nanna' ? 'ğŸ‰ Nanna vinder!' : 'Computer vinder!';
  const detail = winner === 'nanna' ? `Nanna nÃ¥ede ${nannaTotal} point!` : `Computer nÃ¥ede ${compTotal} point.`;
  document.getElementById('end-title').textContent  = title;
  document.getElementById('end-detail').textContent = detail;
  setTimeout(() => endScreen.classList.add('show'), 700);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI â€” RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function makeDieEl(die, cssClass = '', clickHandler = null) {
  const el = document.createElement('div');
  el.classList.add('die');
  if (cssClass) el.classList.add(cssClass);

  // Prikker
  const face = document.createElement('div');
  face.classList.add('die__face');
  const DOT_POSITIONS = {
    1: [[1,1]],
    2: [[0,0],[2,2]],
    3: [[0,0],[1,1],[2,2]],
    4: [[0,0],[0,2],[2,0],[2,2]],
    5: [[0,0],[0,2],[1,1],[2,0],[2,2]],
    6: [[0,0],[0,2],[1,0],[1,2],[2,0],[2,2]],
  };
  for (const [r,c] of (DOT_POSITIONS[die.value] || [])) {
    const dot = document.createElement('div');
    dot.classList.add('die__dot');
    dot.style.gridRow = r + 1;
    dot.style.gridColumn = c + 1;
    face.appendChild(dot);
  }
  el.appendChild(face);

  if (clickHandler) el.addEventListener('click', () => clickHandler(die));
  return el;
}

function renderActiveDice(diceArr, rolling = false) {
  diceArea.innerHTML = '';
  const count = diceArr.length || 6 - heldDice.length;
  if (diceArr.length === 0) {
    for (let i = 0; i < count; i++) {
      const ph = document.createElement('div');
      ph.classList.add('die');
      ph.style.opacity = '0.15';
      diceArea.appendChild(ph);
    }
    return;
  }
  for (const d of diceArr) {
    const el = makeDieEl(d, rolling ? 'die--rolling' : '');
    // TilfÃ¦ldig animation-forsinkelse for mere naturligt look
    if (rolling) el.style.animationDelay = (Math.random() * 0.12) + 's';
    diceArea.appendChild(el);
  }
}

function renderActiveDiceWithScoring(diceArr, scoringIds) {
  diceArea.innerHTML = '';
  // Placer scoring-terninger med klik-handler
  const currentScoringIds = scoringDiceIdsMini(diceArr);
  for (const d of diceArr) {
    const isScoring = currentScoringIds.has(d.id);
    const el = makeDieEl(d, isScoring ? 'die--scoring' : '');
    if (isScoring && canHold) {
      el.addEventListener('click', () => holdDie(d, currentScoringIds));
    }
    diceArea.appendChild(el);
  }
}

function holdDie(die, scoringIds) {
  if (!canHold || currentTurn !== 'nanna') return;

  // Fly-animation
  const els = [...diceArea.querySelectorAll('.die')];
  const idx  = activeDice.findIndex(d => d.id === die.id);
  if (idx !== -1 && els[idx]) {
    els[idx].classList.add('die--fly');
  }

  setTimeout(() => {
    // Flyt til held
    activeDice = activeDice.filter(d => d.id !== die.id);
    heldDice.push({ ...die, held: true });
    turnScore = scoreRollMini(heldDice);
    setTurnScore(turnScore);

    const remScoring = scoringDiceIdsMini(activeDice);
    renderActiveDiceWithScoring(activeDice, remScoring);
    renderHeldDice(heldDice);

    if (activeDice.length === 0) {
      setStatus('Alle terninger holdt! Kast igen (alle 6) eller stop');
    } else {
      setStatus('Tryk pÃ¥ grÃ¸nne terninger â€” eller kast/stop');
    }
  }, 320);
}

function renderHeldDice(diceArr) {
  heldArea.innerHTML = '';
  for (const d of diceArr) {
    const el = makeDieEl(d, 'die--held');
    // Holdte terninger kan frigives (klik sender tilbage til aktiv)
    if (currentTurn === 'nanna' && canHold) {
      el.addEventListener('click', () => unholdDie(d));
      el.title = 'Tryk for at frigive';
    }
    heldArea.appendChild(el);
  }
}

function unholdDie(die) {
  if (!canHold || currentTurn !== 'nanna') return;
  heldDice   = heldDice.filter(d => d.id !== die.id);
  activeDice.push({ ...die, held: false });
  turnScore  = scoreRollMini(heldDice);
  setTurnScore(turnScore);

  const scoring = scoringDiceIdsMini(activeDice);
  renderActiveDiceWithScoring(activeDice, scoring);
  renderHeldDice(heldDice);
  setStatus('Tryk pÃ¥ grÃ¸nne terninger â€” eller kast/stop');
}

function renderActiveDiceBust(diceArr) {
  diceArea.innerHTML = '';
  for (const d of diceArr) {
    const el = makeDieEl(d, 'die--bust');
    diceArea.appendChild(el);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI â€” SCORE OG STATUS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setTurnScore(val, isBust = false) {
  turnScoreEl.textContent = val;
  turnScoreEl.className   = isBust ? 'bust' : '';
}

function setStatus(msg, cssClass = '') {
  statusEl.textContent = msg;
  statusEl.className   = cssClass;
}

function setActiveTurn(who) {
  document.getElementById('card-nanna').classList.toggle('active-turn', who === 'nanna');
  document.getElementById('card-comp').classList.toggle('active-turn',  who === 'comp');
}

function updateScoreboard() {
  document.getElementById('score-nanna').textContent = nannaTotal;
  document.getElementById('score-comp').textContent  = compTotal;
  document.getElementById('bar-nanna').style.width   = Math.min(nannaTotal / GOAL * 100, 100) + '%';
  document.getElementById('bar-comp').style.width    = Math.min(compTotal  / GOAL * 100, 100) + '%';
}

function showScorePopup(points) {
  const popup = document.createElement('div');
  popup.classList.add('score-popup');
  popup.textContent = `+${points}`;
  const rect = document.getElementById('card-nanna').getBoundingClientRect();
  popup.style.left = rect.left + rect.width / 2 - 40 + 'px';
  popup.style.top  = rect.top  - 10 + 'px';
  document.body.appendChild(popup);
  setTimeout(() => popup.remove(), 1300);
}

function wait(ms) { return new Promise(r => setTimeout(r, ms)); }
</script>
</body>
</html>
